<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Nonlinear mixed-effects modelling with nlmixr2 - 3&nbsp; Getting started with rxode2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./history.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting started with <code>rxode2</code></span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Nonlinear mixed-effects modelling with nlmixr2</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/kestrel99/nlmixr2_book/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./history.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">History</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting_started_with_rxode2.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting started with <code>rxode2</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">3.1</span>  Introduction</a></li>
  <li><a href="#writing-models-for-rxode2" id="toc-writing-models-for-rxode2" class="nav-link" data-scroll-target="#writing-models-for-rxode2"><span class="toc-section-number">3.2</span>  Writing models for <code>rxode2</code></a>
  <ul class="collapse">
  <li><a href="#model-blocks" id="toc-model-blocks" class="nav-link" data-scroll-target="#model-blocks"><span class="toc-section-number">3.2.1</span>  Model blocks</a></li>
  <li><a href="#making-statements-rxode2-nomenclature-and-syntax" id="toc-making-statements-rxode2-nomenclature-and-syntax" class="nav-link" data-scroll-target="#making-statements-rxode2-nomenclature-and-syntax"><span class="toc-section-number">3.2.2</span>  Making statements: <code>rxode2</code> nomenclature and syntax</a></li>
  </ul></li>
  <li><a href="#model-parameters-a-named-vector-is-required" id="toc-model-parameters-a-named-vector-is-required" class="nav-link" data-scroll-target="#model-parameters-a-named-vector-is-required"><span class="toc-section-number">4</span>  model parameters – a named vector is required</a></li>
  <li><a href="#state-variables-and-their-amounts-at-time-0-the-use-of-names-is" id="toc-state-variables-and-their-amounts-at-time-0-the-use-of-names-is" class="nav-link" data-scroll-target="#state-variables-and-their-amounts-at-time-0-the-use-of-names-is"><span class="toc-section-number">5</span>  state variables and their amounts at time 0 (the use of names is</a></li>
  <li><a href="#encouraged-but-not-required" id="toc-encouraged-but-not-required" class="nav-link" data-scroll-target="#encouraged-but-not-required"><span class="toc-section-number">6</span>  encouraged, but not required)</a></li>
  <li><a href="#qd1-is-an-eventtable-specification-with-a-set-of-dosing-and-sampling" id="toc-qd1-is-an-eventtable-specification-with-a-set-of-dosing-and-sampling" class="nav-link" data-scroll-target="#qd1-is-an-eventtable-specification-with-a-set-of-dosing-and-sampling"><span class="toc-section-number">7</span>  qd1 is an eventTable specification with a set of dosing and sampling</a></li>
  <li><a href="#records-code-not-shown-here" id="toc-records-code-not-shown-here" class="nav-link" data-scroll-target="#records-code-not-shown-here"><span class="toc-section-number">8</span>  records (code not shown here)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting started with <code>rxode2</code></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">3.1</span> Introduction</h2>
<p><code>rxode2</code> is a set of R packages for solving and simulating from models based on ordinary differential equations (ODEs). These models are expressed in <code>rxode2</code>’s coding shorthand and subsequently compiled via C into dynamic link libraries optimized for speed. <code>rxode2</code> has several key components, split across several R packages (why this was done is complex, but boils down to CRAN objections to the time it took a single unified package to compile):</p>
<ul>
<li><code>rxode2</code>: The core package</li>
<li><code>rxode2et</code>: Event table functions</li>
<li><code>rxode2parse</code>: The rxode2 parser</li>
<li><code>rxode2ll</code>: Log-likelihood functions for a wide range of statistical distributions</li>
<li><code>rxode2random</code>: Random-number generators for a wide range of statistical distributions</li>
</ul>
<p>These should all have been installed automatically along with <code>nlmixr2</code>. We’re going to start with <code>rxode2</code> because it forms the computational core of <code>nlmixr2</code>, and uses the same shorthand for specifying models.</p>
</section>
<section id="writing-models-for-rxode2" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="writing-models-for-rxode2"><span class="header-section-number">3.2</span> Writing models for <code>rxode2</code></h2>
<p>Writing models for <code>rxode2</code> (and by extension <code>nlmixr2</code>) is relatively straightforward. Here’s a simple example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|eval: false</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rxode2)   <span class="co"># load the core rxode2 library</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>rxode2 2.0.11 using 8 threads (see ?getRxThreads)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ini</span>({</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># central compartment</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    KA   <span class="ot">=</span> <span class="fl">0.294</span>  <span class="co"># /h</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    CL   <span class="ot">=</span> <span class="fl">18.6</span>   <span class="co"># L/h</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    V2   <span class="ot">=</span> <span class="fl">40.2</span>   <span class="co"># L</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># peripheral compartment</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    Q    <span class="ot">=</span> <span class="fl">10.5</span>   <span class="co"># L/h</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    V3   <span class="ot">=</span> <span class="dv">297</span>    <span class="co"># L</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># effects</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    Kin  <span class="ot">=</span> <span class="dv">1</span>      <span class="co"># Effect generation rate constant (/h)</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    Kout <span class="ot">=</span> <span class="dv">1</span>      <span class="co"># Effect elimination rate constant (/h)</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    EC50 <span class="ot">=</span> <span class="dv">200</span>    <span class="co"># EC50 (ug/ml)</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>({</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    C2          <span class="ot">&lt;-</span> centr<span class="sc">/</span>V2   <span class="co"># concentration in the central compartment</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    C3          <span class="ot">&lt;-</span> peri<span class="sc">/</span>V3    <span class="co"># concentration in the peripheral compartment</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(depot) <span class="ot">&lt;-</span> <span class="sc">-</span>KA<span class="sc">*</span>depot                         <span class="co"># depot compartment</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(centr) <span class="ot">&lt;-</span>  KA<span class="sc">*</span>depot <span class="sc">-</span> CL<span class="sc">*</span>C2 <span class="sc">-</span> Q<span class="sc">*</span>C2 <span class="sc">+</span> Q<span class="sc">*</span>C3   <span class="co"># central compartment</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(peri)  <span class="ot">&lt;-</span>                     Q<span class="sc">*</span>C2 <span class="sc">-</span> Q<span class="sc">*</span>C3   <span class="co"># peripheral compartment</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">eff</span>(<span class="dv">0</span>)      <span class="ot">&lt;-</span> <span class="dv">1</span>          <span class="co"># amount in the effect compartment at time 0</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(eff)   <span class="ot">&lt;-</span> Kin <span class="sc">-</span> Kout<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>C2<span class="sc">/</span>(EC50<span class="sc">+</span>C2))<span class="sc">*</span>eff   <span class="co"># effect compartment</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There’s a lot to unpack here! An <code>rxode2</code> model specification consists of a series of one or more statements, optionally terminated by semicolons, and comments (delimited by # and an end-of-line). Comments are also optional.</p>
<section id="model-blocks" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="model-blocks"><span class="header-section-number">3.2.1</span> Model blocks</h3>
<p><code>rxode2</code> models are divided into two discrete blocks: <code>ini()</code>, which sets initial conditions, and <code>model()</code>, which defines the model and other aspects of the system that change with time. Blocks of statements are delimited by curly braces. The <code>ini()</code> section is pretty straightforward, as you see, with important variables in the system being assigned their starting values. You can also include a variety of other statements (such as conditionals, <code>while</code> loops and print commands) if you wish.</p>
<p>The <code>model()</code> block is where the action is. Here, as you might imagine, we define the model: the components of the system that change with the independent variable (often this is time). In our example, we are doing the following:</p>
<ul>
<li>Defining concentrations <code>C2</code> and <code>C3</code> in the central (<code>centr</code>) and peripheral (<code>peri</code>) PK compartments, respectively</li>
<li>Defining the differential equations for the depot (<code>depot</code>), <code>centr</code>, <code>peri</code> and effect (<code>eff</code>) compartments</li>
<li>Defining the starting amount in <code>eff</code> (1 at time 0)</li>
</ul>
</section>
<section id="making-statements-rxode2-nomenclature-and-syntax" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="making-statements-rxode2-nomenclature-and-syntax"><span class="header-section-number">3.2.2</span> Making statements: <code>rxode2</code> nomenclature and syntax</h3>
<p>Before we go any further, it’s probably useful to spend a bit of time talking about assignments, nomenclature and syntax in <code>rxode2</code>.</p>
<section id="assignments-and-operators" class="level4" data-number="3.2.2.1">
<h4 data-number="3.2.2.1" class="anchored" data-anchor-id="assignments-and-operators"><span class="header-section-number">3.2.2.1</span> Assignments and operators</h4>
<p>Assignment statements can be:</p>
<ul>
<li>simple assignments, in which the left-hand side is an identifier (a variable)</li>
<li>time-derivative assignments, where the left-hand side specifies the change of the amount in the corresponding state variable (compartment) with respect to time, e.g.&nbsp;<code>d/dt(depot)</code></li>
<li>special initial-condition assignments in which the left-hand side specifies the compartment of the initial condition being specified, e.g.&nbsp;<code>depot(0) = 0</code></li>
<li>special model event changes such as bioavailability (e.g.&nbsp;<code>f(depot) = 1</code>), lag time (e.g.&nbsp;<code>alag(depot) = 0</code>), modeled rate (e.g.&nbsp;<code>rate(depot) = 2</code>) and modeled duration of infusion (e.g.&nbsp;<code>dur(depot) = 2</code>)</li>
<li>change-point syntax, or modeled event times, e.g <code>mtime(var) = time</code></li>
<li>Jacobian-derivative assignments, in which the left hand specifies the change in the compartment ODE with respect to a variable. For example, if <code>d/dt(y) = dy</code>, then a Jacobian for this compartment can be specified as <code>df(y)/dy(dy) = 1</code>. There may be some advantage to obtaining the solution or specifying the Jacobian for very stiff ODE systems. However, for the few stiff systems we tried with LSODA, this actually slowed things down</li>
</ul>
<p>Assignments can be made using <code>=</code>, <code>&lt;-</code> or <code>~</code>. When using the <code>~</code> operator, simple assignments and time-derivative assignments will not be output.</p>
<p>Special statements can be:</p>
<ul>
<li>Compartment declaration statements, which can change the default dosing compartment and the assumed compartment number(s) as well as add extra compartment names at the end (useful for multiple-endpoint <code>nlmixr2</code> models); these can be specified using <code>cmt(compartmentName)</code></li>
<li>Parameter declaration statements, which can be used to ensure the input parameters are kept in a certain order instead of ordering the parameters by the order in which they are parsed. This is useful for keeping the parameter order the same when using different ODE models, for example (e.g.&nbsp;<code>param(par1, par2,...)</code>)</li>
</ul>
<p>Expressions in assignment and in conditional (<code>if</code>) statements can be numeric or logical.</p>
<p>Numeric expressions can include the standard numeric operators (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>) as well as mathematical functions defined in the C or the R math libraries (e.g.&nbsp;<code>fabs</code>, <code>exp</code>, <code>log</code>, <code>sin</code>, <code>abs</code>). You may also access R’s math functions, like <code>lgammafn</code> for the log gamma function.</p>
<p><code>rxode2</code> syntax is case-sensitive, like the rest of R: <code>ABC</code> is different from <code>abc</code>, <code>Abc</code>, <code>ABc</code>, and so forth.</p>
</section>
<section id="identifiers" class="level4" data-number="3.2.2.2">
<h4 data-number="3.2.2.2" class="anchored" data-anchor-id="identifiers"><span class="header-section-number">3.2.2.2</span> Identifiers</h4>
<p>As in R, identifiers (variable names) may consist of one or more alphanumeric, underscore (<code>_</code>) or period (<code>.</code>) characters, although the first character cannot be a digit or underscore.</p>
<p>Identifiers in a model specification can take the following forms:</p>
<ul>
<li>State variables in the dynamic system (e.g.&nbsp;compartments in a pharmacokinetics model)</li>
<li>Implied input variable, <code>t</code> (time), <code>tlast</code> (last time point), and <code>podo</code> (oral dose, in the case of absorption transit models)</li>
<li>Special constants such as <code>pi</code> or R’s predefined constants</li>
<li>Model parameters (such as rate of absorption and clearance)</li>
<li>Other left-hand side (LHS) variables created by assignments as part of the model specification</li>
</ul>
<p>Currently, the <code>rxode2</code> modeling language only recognizes system state variables and parameters. Any values that need to be passed from R to the ODE model (such as covariates) must be passed in the <code>params</code> argument of the integrator function (<code>rxSolve()</code>) or be available in the supplied event dataset, which we’ll get to in a bit.</p>
<p>Some variable names are reserved for use in <code>rxode2</code> event tables. The following items cannot be assigned, or used as a state, but can be accessed in the <code>rxode2</code> code:</p>
<ul>
<li><code>cmt</code>: compartment</li>
<li><code>dvid</code>: dependent variable ID</li>
<li><code>addl</code>: number of additional doses</li>
<li><code>ss</code>: steady state</li>
<li><code>rate</code>: infusion rate</li>
<li><code>id</code>: unique subject identifier</li>
</ul>
<p>The following variables, however, cannot be used in a model specification in any way:</p>
<ul>
<li><code>evid</code>: event type</li>
<li><code>ii</code>: interdose interval</li>
</ul>
<p>Sometimes rxode2 generates variables that are fed back to rxode2. Similarly, nlmixr generates some variables that are used in nlmixr estimation and simulation. These variables start with the either the rx or nlmixr prefixes. To avoid any problems, it is suggested to not use these variables starting with either the rx or nlmixr prefixes.</p>
<p>Logical Operators Logical operators support the standard R operators ==, != &gt;= &lt;= &gt; and &lt;. Like R these can be in if() or while() statements, ifelse() expressions. Additionally they can be in a standard assignment. For instance, the following is valid:</p>
<p>cov1 = covm<em>(sexf == “female”) + covm</em>(sexf != “female”) Notice that you can also use character expressions in comparisons. This convenience comes at a cost since character comparisons are slower than numeric expressions. Unlike R, as.numeric or as.integer for these logical statements is not only not needed, but will cause an syntax error if you try to use the function.</p>
<p>Interface and data handling between R and the generated C code Users specify which variables are the dynamic system’s state variables via the d/dt(identifier) operator as part of the model specification, and which are model parameters via the params= argument in rxode2 solve() method:</p>
<p>m1 &lt;- rxode2(model = ode, modName = “m1”)</p>
</section>
</section>
</section>
<section id="model-parameters-a-named-vector-is-required" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> model parameters – a named vector is required</h1>
<p>theta &lt;- c(KA=0.29, CL=18.6, V2=40.2, Q=10.5, V3=297, Kin=1, Kout=1, EC50=200)</p>
</section>
<section id="state-variables-and-their-amounts-at-time-0-the-use-of-names-is" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> state variables and their amounts at time 0 (the use of names is</h1>
</section>
<section id="encouraged-but-not-required" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> encouraged, but not required)</h1>
<p>inits &lt;- c(depot=0, centr=0, peri=0, eff=1)</p>
</section>
<section id="qd1-is-an-eventtable-specification-with-a-set-of-dosing-and-sampling" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> qd1 is an eventTable specification with a set of dosing and sampling</h1>
</section>
<section id="records-code-not-shown-here" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> records (code not shown here)</h1>
<p>solve(theta, event = qd1, inits = inits) The values of these variables at pre-specified time points are saved during model fitting/integration and returned as part of the fitted values (see the function eventTable, in particular its member function add.sampling function to define a set of time points when to capture the values of these variables) and returned as part of the modeling output.</p>
<p>The ODE specification mini-language is parsed with the help of the open source tool DParser, Plevyak (2015).</p>
<p>Supported functions All the supported functions in rxode2 can be seen with the rxSupportedFuns().</p>
<p>A brief description of the built-in functions are in the following table:</p>
<pre><code>rxode2() which creates the C code for fast ODE solving based on a simple syntax related to Leibnitz notation.
The event data, which can be:
    a NONMEM or deSolve compatible data frame, or
    created with et() or eventTable() for easy simulation of events
    The data frame can be augmented by adding time-varying or adding individual covariates (iCov= as needed)
rxSolve() which solves the system of equations using initial conditions and parameters to make predictions
    With multiple subject data, this may be parallelized.
    With single subject the output data frame is adaptive
    Covariances and other metrics of uncertanty can be used to simulate while solving</code></pre>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./history.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">History</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Nonlinear mixed-effects modelling with nlmixr2 was written by Justin Wilkins, Matthew Fidler, William Denney, John Harrold, Richard Hooijmaaijers, Rik Schoemaker, Mirjam Trame, Yuan Xiong and Huijuan Xu.</div>   
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>