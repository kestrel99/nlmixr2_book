<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Nonlinear mixed-effects modelling with nlmixr2 - 7&nbsp; Getting started with rxode2: simulating single subjects</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08_populations.html" rel="next">
<link href="./06_events.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05_getting_started.html">Simulations with <code>rxode2</code></a></li><li class="breadcrumb-item"><a href="./07_single_subjects.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Getting started with `rxode2`: simulating single subjects</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Nonlinear mixed-effects modelling with nlmixr2</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/kestrel99/nlmixr2_book/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_prerequisites.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Prerequisites</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_history.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">History</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_intro_to_nlme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">A brief introduction to nonlinear mixed-effects modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Simulations with <code>rxode2</code></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_events.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Events in <code>rxode2</code> and <code>nlmixr2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_single_subjects.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Getting started with <code>rxode2</code>: simulating single subjects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_populations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Simulating populations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_more_complex_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">More complex examples</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Modeling with <code>nlmixr2</code></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_parameter_estimation_and_model_fitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Parameter estimation and model fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_diagnostics_and_evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Model diagnostics and evaluation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_handling_covariate_effects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Handling Covariate Effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_model_selection_and_comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Model Selection and Comparison</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_case_studies_and_practical_applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Case Studies and Practical Applications</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_tracking_work_with_shinymixr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Tracking work with <code>shinyMixR</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Advanced topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_inside_mixrverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Inside the mixrverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_extending_mixrverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Extending the mixrverse</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">The mixrverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_qualifying_mixrverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Qualifying the mixrverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_babelmixr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title"><code>babelmixr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_mixrverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Into the mixrverse</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">The future</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_future_directions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Future Directions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_final_thoughts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Conclusion and Final Thoughts</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./function_reference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Function reference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#basic-concepts-of-rxode2-syntax" id="toc-basic-concepts-of-rxode2-syntax" class="nav-link active" data-scroll-target="#basic-concepts-of-rxode2-syntax"><span class="header-section-number">7.1</span> Basic concepts of <code>rxode2</code> syntax</a>
  <ul class="collapse">
  <li><a href="#writing-models-for-rxode2" id="toc-writing-models-for-rxode2" class="nav-link" data-scroll-target="#writing-models-for-rxode2"><span class="header-section-number">7.1.1</span> Writing models for <code>rxode2</code></a></li>
  <li><a href="#model-blocks" id="toc-model-blocks" class="nav-link" data-scroll-target="#model-blocks"><span class="header-section-number">7.1.2</span> Model blocks</a></li>
  <li><a href="#making-statements-rxode2-nomenclature-and-syntax" id="toc-making-statements-rxode2-nomenclature-and-syntax" class="nav-link" data-scroll-target="#making-statements-rxode2-nomenclature-and-syntax"><span class="header-section-number">7.1.3</span> Making statements: <code>rxode2</code> nomenclature and syntax</a></li>
  <li><a href="#interface-and-data-handling-between-r-and-the-generated-c-code" id="toc-interface-and-data-handling-between-r-and-the-generated-c-code" class="nav-link" data-scroll-target="#interface-and-data-handling-between-r-and-the-generated-c-code"><span class="header-section-number">7.1.4</span> Interface and data handling between R and the generated C code</a></li>
  <li><a href="#supported-functions" id="toc-supported-functions" class="nav-link" data-scroll-target="#supported-functions"><span class="header-section-number">7.1.5</span> Supported functions</a></li>
  </ul></li>
  <li><a href="#other-model-types" id="toc-other-model-types" class="nav-link" data-scroll-target="#other-model-types"><span class="header-section-number">7.2</span> Other model types</a>
  <ul class="collapse">
  <li><a href="#prediction-only-models" id="toc-prediction-only-models" class="nav-link" data-scroll-target="#prediction-only-models"><span class="header-section-number">7.2.1</span> “Prediction-only” models</a></li>
  <li><a href="#solved-systems" id="toc-solved-systems" class="nav-link" data-scroll-target="#solved-systems"><span class="header-section-number">7.2.2</span> Solved systems</a></li>
  <li><a href="#combining-odes-and-solved-systems" id="toc-combining-odes-and-solved-systems" class="nav-link" data-scroll-target="#combining-odes-and-solved-systems"><span class="header-section-number">7.2.3</span> Combining ODEs and solved systems</a></li>
  </ul></li>
  <li><a href="#compartment-numbers" id="toc-compartment-numbers" class="nav-link" data-scroll-target="#compartment-numbers"><span class="header-section-number">7.3</span> Compartment numbers</a>
  <ul class="collapse">
  <li><a href="#how-rxode2-assigns-compartment-numbers" id="toc-how-rxode2-assigns-compartment-numbers" class="nav-link" data-scroll-target="#how-rxode2-assigns-compartment-numbers"><span class="header-section-number">7.3.1</span> How <code>rxode2</code> assigns compartment numbers</a></li>
  <li><a href="#pre-declaring-the-compartments" id="toc-pre-declaring-the-compartments" class="nav-link" data-scroll-target="#pre-declaring-the-compartments"><span class="header-section-number">7.3.2</span> Pre-declaring the compartments</a></li>
  <li><a href="#appending-compartments" id="toc-appending-compartments" class="nav-link" data-scroll-target="#appending-compartments"><span class="header-section-number">7.3.3</span> Appending compartments</a></li>
  </ul></li>
  <li><a href="#transit-compartments" id="toc-transit-compartments" class="nav-link" data-scroll-target="#transit-compartments"><span class="header-section-number">7.4</span> Transit compartments</a></li>
  <li><a href="#covariates" id="toc-covariates" class="nav-link" data-scroll-target="#covariates"><span class="header-section-number">7.5</span> Covariates</a></li>
  <li><a href="#multiple-subjects" id="toc-multiple-subjects" class="nav-link" data-scroll-target="#multiple-subjects"><span class="header-section-number">7.6</span> Multiple subjects</a></li>
  <li><a href="#working-with-rxode2-output" id="toc-working-with-rxode2-output" class="nav-link" data-scroll-target="#working-with-rxode2-output"><span class="header-section-number">7.7</span> Working with <code>rxode2</code> output</a></li>
  <li><a href="#piping" id="toc-piping" class="nav-link" data-scroll-target="#piping"><span class="header-section-number">7.8</span> Piping</a></li>
  <li><a href="#special-cases" id="toc-special-cases" class="nav-link" data-scroll-target="#special-cases"><span class="header-section-number">7.9</span> Special cases</a>
  <ul class="collapse">
  <li><a href="#jacobian-solving" id="toc-jacobian-solving" class="nav-link" data-scroll-target="#jacobian-solving"><span class="header-section-number">7.9.1</span> Jacobian solving</a></li>
  <li><a href="#rxode2-models-in-shiny" id="toc-rxode2-models-in-shiny" class="nav-link" data-scroll-target="#rxode2-models-in-shiny"><span class="header-section-number">7.9.2</span> <code>rxode2</code> models in <code>shiny</code></a></li>
  <li><a href="#precompiled-rxode2-models-in-other-r-packages" id="toc-precompiled-rxode2-models-in-other-r-packages" class="nav-link" data-scroll-target="#precompiled-rxode2-models-in-other-r-packages"><span class="header-section-number">7.9.3</span> Precompiled <code>rxode2</code> models in other R packages</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="rxode2" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Getting started with <code>rxode2</code>: simulating single subjects</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="basic-concepts-of-rxode2-syntax" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="basic-concepts-of-rxode2-syntax"><span class="header-section-number">7.1</span> Basic concepts of <code>rxode2</code> syntax</h2>
<p>Now that we’ve got to grips with events, let’s have a look at the models themselves!</p>
<section id="writing-models-for-rxode2" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="writing-models-for-rxode2"><span class="header-section-number">7.1.1</span> Writing models for <code>rxode2</code></h3>
<p>Writing models for <code>rxode2</code> (and by extension <code>nlmixr2</code>) is relatively straightforward. Here’s a simple example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rxode2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>rxode2 2.0.14 using 1 threads (see ?getRxThreads)
  no cache: create with `rxCreateCache()`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>========================================
rxode2 has not detected OpenMP support and will run in single-threaded mode
This is a Mac. Please read https://mac.r-project.org/openmp/
========================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ini</span>({</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># central compartment</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    KA   <span class="ot">=</span> <span class="fl">0.294</span>  <span class="co"># /h</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    CL   <span class="ot">=</span> <span class="fl">18.6</span>   <span class="co"># L/h</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    V2   <span class="ot">=</span> <span class="fl">40.2</span>   <span class="co"># L</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># peripheral compartment</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    Q    <span class="ot">=</span> <span class="fl">10.5</span>   <span class="co"># L/h</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    V3   <span class="ot">=</span> <span class="dv">297</span>    <span class="co"># L</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># effects</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    Kin  <span class="ot">=</span> <span class="dv">1</span>      <span class="co"># Effect generation rate constant (/h)</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    Kout <span class="ot">=</span> <span class="dv">1</span>      <span class="co"># Effect elimination rate constant (/h)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    EC50 <span class="ot">=</span> <span class="dv">200</span>    <span class="co"># EC50 (ug/ml)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>({</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    C2          <span class="ot">&lt;-</span> centr<span class="sc">/</span>V2   <span class="co"># concentration in the central compartment</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    C3          <span class="ot">&lt;-</span> peri<span class="sc">/</span>V3    <span class="co"># concentration in the peripheral compartment</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(depot) <span class="ot">&lt;-</span> <span class="sc">-</span>KA<span class="sc">*</span>depot                         <span class="co"># depot compartment</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(centr) <span class="ot">&lt;-</span>  KA<span class="sc">*</span>depot <span class="sc">-</span> CL<span class="sc">*</span>C2 <span class="sc">-</span> Q<span class="sc">*</span>C2 <span class="sc">+</span> Q<span class="sc">*</span>C3   <span class="co"># central compartment</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(peri)  <span class="ot">&lt;-</span>                     Q<span class="sc">*</span>C2 <span class="sc">-</span> Q<span class="sc">*</span>C3   <span class="co"># peripheral compartment</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">eff</span>(<span class="dv">0</span>)      <span class="ot">&lt;-</span> <span class="dv">1</span>          <span class="co"># amount in the effect compartment at time 0</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(eff)   <span class="ot">&lt;-</span> Kin <span class="sc">-</span> Kout<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>C2<span class="sc">/</span>(EC50<span class="sc">+</span>C2))<span class="sc">*</span>eff   <span class="co"># effect compartment</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Yes, yes, I know we said simple. There’s a lot to unpack here! This code represents a two-compartmental PK model with first-order absorption and linear elimination.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 466.32 326.77" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 322.77)">
<title>
Model
</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-322.77 462.32,-322.77 462.32,4 -4,4"></polygon> <!-- Depot --> <g id="node1" class="node">
<title>
Depot
</title>
<polygon fill="none" stroke="black" points="301.87,-220 221.02,-220 221.02,-184 301.87,-184 301.87,-220"></polygon> <text text-anchor="middle" x="261.45" y="-197.8" font-family="Times,serif" font-size="14.00">Gut (depot)</text> </g> <!-- V2 --> <g id="node2" class="node">
<title>
V2
</title>
<polygon fill="none" stroke="black" points="328.52,-135.8 194.38,-135.8 194.38,-94.6 328.52,-94.6 328.52,-135.8"></polygon> <text text-anchor="middle" x="261.45" y="-119.4" font-family="Times,serif" font-size="14.00">Central compartment</text> <text text-anchor="middle" x="261.45" y="-102.6" font-family="Times,serif" font-size="14.00">(centr)</text> </g> <!-- Depot&#45;&gt;V2 --> <g id="edge5" class="edge">
<title>
Depot-&gt;V2
</title>
<path fill="none" stroke="black" d="M261.45,-183.84C261.45,-173.03 261.45,-158.77 261.45,-146.13"></path> <polygon fill="black" stroke="black" points="264.95,-146.01 261.45,-136.01 257.95,-146.01 264.95,-146.01"></polygon> <text text-anchor="middle" x="268.67" y="-157" font-family="Times,serif" font-size="10.00"> ka </text> </g> <!-- V3 --> <g id="node3" class="node">
<title>
V3
</title>
<polygon fill="none" stroke="black" points="150.84,-135.8 0.05,-135.8 0.05,-94.6 150.84,-94.6 150.84,-135.8"></polygon> <text text-anchor="middle" x="75.45" y="-119.4" font-family="Times,serif" font-size="14.00">Peripheral compartment</text> <text text-anchor="middle" x="75.45" y="-102.6" font-family="Times,serif" font-size="14.00">(peri)</text> </g> <!-- V2&#45;&gt;V3 --> <g id="edge6" class="edge">
<title>
V2-&gt;V3
</title>
<path fill="none" stroke="black" d="M194.23,-115.2C183.51,-115.2 172.3,-115.2 161.22,-115.2"></path> <polygon fill="black" stroke="black" points="161.1,-111.7 151.1,-115.2 161.1,-118.7 161.1,-111.7"></polygon> <text text-anchor="middle" x="172.53" y="-133.2" font-family="Times,serif" font-size="10.00"> k23 =</text> <text text-anchor="middle" x="172.53" y="-121.2" font-family="Times,serif" font-size="10.00">Q/V2 </text> </g> <!-- Excreted --> <g id="node4" class="node">
<title>
Excreted
</title>
<polygon fill="white" stroke="white" points="458.19,-133.2 392.7,-133.2 392.7,-97.2 458.19,-97.2 458.19,-133.2"></polygon> <text text-anchor="middle" x="425.45" y="-111" font-family="Times,serif" font-size="14.00" fill="blue">Excreted</text> </g> <!-- V2&#45;&gt;Excreted --> <g id="edge8" class="edge">
<title>
V2-&gt;Excreted
</title>
<path fill="none" stroke="black" d="M328.63,-115.2C346.62,-115.2 365.6,-115.2 381.94,-115.2"></path> <polygon fill="black" stroke="black" points="382.27,-118.7 392.27,-115.2 382.27,-111.7 382.27,-118.7"></polygon> <text text-anchor="middle" x="360.65" y="-121.2" font-family="Times,serif" font-size="10.00">k = CL/V2 </text> </g> <!-- ab --> <g id="node8" class="node">
<title>
ab
</title>
</g> <!-- V2&#45;&gt;ab --> <g id="edge9" class="edge">
<title>
V2-&gt;ab
</title>
<path fill="none" stroke="orange" stroke-dasharray="5,2" d="M261.45,-94.15C261.45,-72.55 261.45,-39.59 261.45,-26.97"></path> <polygon fill="orange" stroke="orange" points="256.45,-22.93 266.45,-22.93 266.45,-24.93 256.45,-24.93 256.45,-22.93"></polygon> <polyline fill="none" stroke="orange" points="261.45,-21.93 261.45,-26.93 "></polyline> <text text-anchor="middle" x="299.8" y="-63.8" font-family="Times,serif" font-size="14.00" fill="orange"> C2=centr/V2</text> </g> <!-- V3&#45;&gt;V2 --> <g id="edge7" class="edge">
<title>
V3-&gt;V2
</title>
<path fill="none" stroke="black" d="M123.56,-94.53C142.66,-88.65 164.92,-84.68 185.35,-88.2 190.48,-89.08 195.73,-90.28 200.95,-91.68"></path> <polygon fill="black" stroke="black" points="200.34,-95.15 210.92,-94.59 202.3,-88.43 200.34,-95.15"></polygon> <text text-anchor="middle" x="172.53" y="-103.2" font-family="Times,serif" font-size="10.00"> k32 =</text> <text text-anchor="middle" x="172.53" y="-91.2" font-family="Times,serif" font-size="10.00">Q/V3</text> </g> <!-- In --> <g id="node5" class="node">
<title>
In
</title>
<polygon fill="white" stroke="white" points="128.45,-38.8 74.45,-38.8 74.45,-2.8 128.45,-2.8 128.45,-38.8"></polygon> <text text-anchor="middle" x="101.45" y="-16.6" font-family="Times,serif" font-size="14.00" fill="white">In</text> </g> <!-- Effect --> <g id="node7" class="node">
<title>
Effect
</title>
<polygon fill="orange" stroke="orange" points="218.45,-41.4 164.45,-41.4 164.45,-0.2 218.45,-0.2 218.45,-41.4"></polygon> <text text-anchor="middle" x="191.45" y="-25" font-family="Times,serif" font-size="14.00">Effect</text> <text text-anchor="middle" x="191.45" y="-8.2" font-family="Times,serif" font-size="14.00">(eff)</text> </g> <!-- In&#45;&gt;Effect --> <g id="edge1" class="edge">
<title>
In-&gt;Effect
</title>
<path fill="none" stroke="black" d="M128.45,-20.8C136.47,-20.8 145.41,-20.8 153.98,-20.8"></path> <polygon fill="black" stroke="black" points="154.15,-24.3 164.15,-20.8 154.15,-17.3 154.15,-24.3"></polygon> <text text-anchor="middle" x="146.45" y="-28" font-family="Times,serif" font-size="14.00">kin</text> </g> <!-- Out --> <g id="node6" class="node">
<title>
Out
</title>
<polygon fill="white" stroke="white" points="351.45,-38.8 297.45,-38.8 297.45,-2.8 351.45,-2.8 351.45,-38.8"></polygon> <text text-anchor="middle" x="324.45" y="-16.6" font-family="Times,serif" font-size="14.00" fill="white">Out</text> </g> <!-- Effect&#45;&gt;ab --> <g id="edge2" class="edge">
<title>
Effect-&gt;ab
</title>
<path fill="none" stroke="black" d="M218.71,-20.8C236.52,-20.8 257.15,-20.8 260.86,-20.8"></path> <text text-anchor="middle" x="239.7" y="-28" font-family="Times,serif" font-size="14.00">kout</text> </g> <!-- ab&#45;&gt;Out --> <g id="edge3" class="edge">
<title>
ab-&gt;Out
</title>
<path fill="none" stroke="black" d="M262.43,-20.8C270.7,-20.8 278.96,-20.8 287.23,-20.8"></path> <polygon fill="black" stroke="black" points="287.31,-24.3 297.31,-20.8 287.31,-17.3 287.31,-24.3"></polygon> </g> <!-- za --> <g id="node9" class="node">
<title>
za
</title>
</g> <!-- Dose --> <g id="node10" class="node">
<title>
Dose
</title>
<ellipse fill="red" stroke="red" cx="261.45" cy="-287.88" rx="30.77" ry="30.77"></ellipse> <text text-anchor="middle" x="261.45" y="-283.68" font-family="Times,serif" font-size="14.00" fill="white">Dose</text> </g> <!-- Dose&#45;&gt;Depot --> <g id="edge4" class="edge">
<title>
Dose-&gt;Depot
</title>
<path fill="none" stroke="black" d="M261.45,-256.6C261.45,-248.02 261.45,-238.73 261.45,-230.34"></path> <polygon fill="black" stroke="black" points="264.95,-230.3 261.45,-220.3 257.95,-230.3 264.95,-230.3"></polygon> </g> </g>
</svg>
</div>
</div>
</div>
</div>
<p>An <code>rxode2</code> model specification consists of a series of one or more statements, optionally terminated by semicolons, and comments (delimited by # and an end-of-line). Comments are also optional.</p>
</section>
<section id="model-blocks" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="model-blocks"><span class="header-section-number">7.1.2</span> Model blocks</h3>
<p><code>rxode2</code> models are divided into two discrete blocks: <code>ini()</code>, which sets initial conditions, and <code>model()</code>, which defines the model and other aspects of the system that change with time. Blocks of statements are delimited by curly braces. The <code>ini()</code> section is pretty straightforward, as you see, with important variables in the system being assigned their starting values. You can also include a variety of other statements (such as conditionals, <code>while</code> loops and print commands) if you wish.</p>
<p>The <code>model()</code> block is where the action is. Here, as you might imagine, we define the model: the components of the system that change with the independent variable (often this is time). In our example, we are doing the following:</p>
<ul>
<li>Defining concentrations <code>C2</code> and <code>C3</code> in the central (<code>centr</code>) and peripheral (<code>peri</code>) PK compartments, respectively</li>
<li>Defining the differential equations for the depot (<code>depot</code>), <code>centr</code>, <code>peri</code> and effect (<code>eff</code>) compartments</li>
<li>Defining the starting amount in <code>eff</code> (1 at time 0)</li>
</ul>
</section>
<section id="making-statements-rxode2-nomenclature-and-syntax" class="level3" data-number="7.1.3">
<h3 data-number="7.1.3" class="anchored" data-anchor-id="making-statements-rxode2-nomenclature-and-syntax"><span class="header-section-number">7.1.3</span> Making statements: <code>rxode2</code> nomenclature and syntax</h3>
<p>Before we go any further, it’s probably useful to spend a bit of time talking about assignments, nomenclature and syntax in <code>rxode2</code>.</p>
<section id="assignments-and-operators" class="level4" data-number="7.1.3.1">
<h4 data-number="7.1.3.1" class="anchored" data-anchor-id="assignments-and-operators"><span class="header-section-number">7.1.3.1</span> Assignments and operators</h4>
<p>Assignment statements can be:</p>
<ul>
<li><em>simple assignments</em>, in which the left-hand side is an identifier (a variable)</li>
<li><em>time-derivative assignments</em>, where the left-hand side specifies the change of the amount in the corresponding state variable (compartment) with respect to time, e.g.&nbsp;<code>d/dt(depot)</code></li>
<li>special <em>initial-condition assignments</em> in which the left-hand side specifies the compartment of the initial condition being specified, e.g.&nbsp;<code>depot(0) = 0</code></li>
<li>special <em>model event changes</em> such as bioavailability (e.g.&nbsp;<code>f(depot) = 1</code>), lag time (e.g.&nbsp;<code>alag(depot) = 0</code>), modeled rate (e.g.&nbsp;<code>rate(depot) = 2</code>) and modeled duration of infusion (e.g.&nbsp;<code>dur(depot) = 2</code>)</li>
<li>special <em>change-point syntax</em>, or <em>modeled event times</em>, e.g <code>mtime(var) = time</code></li>
<li><em>Jacobian-derivative assignments</em>, in which the left hand specifies the change in the compartment ODE with respect to a variable. For example, if <code>d/dt(y) = dy</code>, then a Jacobian for this compartment can be specified as <code>df(y)/dy(dy) = 1</code>. There may be some advantage to obtaining the solution or specifying the Jacobian for very stiff ODE systems. However, for the few stiff systems we tried with LSODA, this actually slowed things down.</li>
</ul>
<p>Assignments can be made using <code>=</code>, <code>&lt;-</code> or <code>~</code>. When using the <code>~</code> operator, simple assignments and time-derivative assignments will not be output.</p>
<p>Special statements can be:</p>
<ul>
<li><em>Compartment declaration statements</em>, which can change the default dosing compartment and the assumed compartment number(s) as well as add extra compartment names at the end (useful for multiple-endpoint <code>nlmixr2</code> models); these can be specified using <code>cmt(compartmentName)</code></li>
<li><em>Parameter declaration statements</em>, which can be used to ensure the input parameters are kept in a certain order instead of ordering the parameters by the order in which they are parsed. This is useful for keeping the parameter order the same when using different ODE models, for example (e.g.&nbsp;<code>param(par1, par2,...)</code>)</li>
</ul>
<p>Expressions in assignment and in conditional (<code>if</code>) statements can be numeric or logical.</p>
<p>Numeric expressions can include the standard numeric operators (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>) as well as mathematical functions defined in the C or the R math libraries (e.g.&nbsp;<code>fabs</code>, <code>exp</code>, <code>log</code>, <code>sin</code>, <code>abs</code>). You may also access R’s math functions, like <code>lgammafn</code> for the log gamma function.</p>
<p><code>rxode2</code> syntax is case-sensitive, like the rest of R: <code>ABC</code> is different from <code>abc</code>, <code>Abc</code>, <code>ABc</code>, and so forth.</p>
</section>
<section id="identifiers" class="level4" data-number="7.1.3.2">
<h4 data-number="7.1.3.2" class="anchored" data-anchor-id="identifiers"><span class="header-section-number">7.1.3.2</span> Identifiers</h4>
<p>As in R, identifiers (variable names) may consist of one or more alphanumeric, underscore (<code>_</code>) or period (<code>.</code>) characters, although the first character cannot be a digit or underscore.</p>
<p>Identifiers in a model specification can take the following forms:</p>
<ul>
<li>State variables in the dynamic system (e.g.&nbsp;compartments in a pharmacokinetics model)</li>
<li>Implied input variable, <code>t</code> (time), <code>tlast</code> (last time point), and <code>podo</code> (oral dose, in the case of absorption transit models)</li>
<li>Special constants such as <code>pi</code> or R’s predefined constants</li>
<li>Model parameters (such as rate of absorption and clearance)</li>
<li>Other left-hand side (LHS) variables created by assignments as part of the model specification</li>
</ul>
<p>Currently, the <code>rxode2</code> modeling language only recognizes system state variables and parameters. Any values that need to be passed from R to the ODE model (such as covariates) must be passed in the <code>params</code> argument of the integrator function (<code>rxSolve()</code>) or be available in the supplied event dataset, which we’ll get to in a bit.</p>
<p>Some variable names are reserved for use in <code>rxode2</code> event tables. The following items cannot be assigned, or used as a state, but can be accessed in the <code>rxode2</code> code:</p>
<ul>
<li><code>cmt</code>: compartment</li>
<li><code>dvid</code>: dependent variable ID</li>
<li><code>addl</code>: number of additional doses</li>
<li><code>ss</code>: steady state</li>
<li><code>rate</code>: infusion rate</li>
<li><code>id</code>: unique subject identifier</li>
</ul>
<p>The following variables, however, cannot be used in a model specification in any way:</p>
<ul>
<li><code>evid</code>: event type</li>
<li><code>ii</code>: interdose interval</li>
</ul>
<p><code>rxode2</code> generates variables which are used internally. These variables start with an <code>rx</code> prefix. To avoid any problems, it is <em>strongly</em> suggested not to use an <code>rx</code> prefix when writing model code, since all kinds of unpleasant and unpredictable things may happen.</p>
</section>
<section id="logical-operators" class="level4" data-number="7.1.3.3">
<h4 data-number="7.1.3.3" class="anchored" data-anchor-id="logical-operators"><span class="header-section-number">7.1.3.3</span> Logical Operators</h4>
<p>Logical operators support the standard R operators (<code>==</code>, <code>!=</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>&gt;</code> and <code>&lt;</code>). As in R, these can be used in <code>if()</code>, <code>while()</code> and <code>ifelse()</code> expressions, as well as in standard assignments. For instance, the following is valid:</p>
<p><code>cov1 = covm*(sexf == "female") + covm*(sexf != "female")</code></p>
<p>Notice that you can also use character expressions in comparisons. This convenience comes at a cost, however, since character comparisons are slower than numeric expressions. Unlike R, <code>as.numeric()</code> or <code>as.integer()</code> for logical statements are not only not needed, but not permitted - they will throw an error if you try to use them.</p>
</section>
</section>
<section id="interface-and-data-handling-between-r-and-the-generated-c-code" class="level3" data-number="7.1.4">
<h3 data-number="7.1.4" class="anchored" data-anchor-id="interface-and-data-handling-between-r-and-the-generated-c-code"><span class="header-section-number">7.1.4</span> Interface and data handling between R and the generated C code</h3>
<p>Users define the dynamic system’s state variables via the <code>d/dt(identifier)</code> statements as part of the model specification, and model parameters via the <code>params</code> argument in the <code>rxode2</code> <code>solve()</code> method:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">rxode2</span>(<span class="at">model =</span> ode, <span class="at">modName =</span> <span class="st">"m1"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># model parameters -- a named vector is required</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">KA=</span><span class="fl">0.29</span>, <span class="at">CL=</span><span class="fl">18.6</span>, <span class="at">V2=</span><span class="fl">40.2</span>, <span class="at">Q=</span><span class="fl">10.5</span>, <span class="at">V3=</span><span class="dv">297</span>, <span class="at">Kin=</span><span class="dv">1</span>, <span class="at">Kout=</span><span class="dv">1</span>, <span class="at">EC50=</span><span class="dv">200</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># state variables and their amounts at time 0 (the use of names is</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># encouraged, but not required)</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">depot=</span><span class="dv">0</span>, <span class="at">centr=</span><span class="dv">0</span>, <span class="at">peri=</span><span class="dv">0</span>, <span class="at">eff=</span><span class="dv">1</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># qd1 is an eventTable specification with a set of dosing and sampling</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># records (code not shown here)</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span>(theta, <span class="at">event =</span> qd1, <span class="at">inits =</span> inits) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The values of these variables at pre-specified time points are saved during model fitting/integration and returned with the fitted values as part of the modeling output (see the function <code>eventTable()</code>, and in particular its member function <code>add.sampling()</code> for further information on defining a set of time points at which to capture the values of these variables).</p>
<p>The ODE specification mini-language is parsed with the help of the open source tool <code>DParser</code> <span class="citation" data-cites="Plevyak">(<a href="references.html#ref-Plevyak" role="doc-biblioref">1</a>)</span>.</p>
</section>
<section id="supported-functions" class="level3" data-number="7.1.5">
<h3 data-number="7.1.5" class="anchored" data-anchor-id="supported-functions"><span class="header-section-number">7.1.5</span> Supported functions</h3>
<p>All the supported functions in <code>rxode2</code> can be seen with the function <code>rxSupportedFuns()</code>. There are a lot of them.</p>
</section>
</section>
<section id="other-model-types" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="other-model-types"><span class="header-section-number">7.2</span> Other model types</h2>
<p><code>rxode2</code> supports a range of model types. So far, we’ve just looked at ODE systems.</p>
<section id="prediction-only-models" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="prediction-only-models"><span class="header-section-number">7.2.1</span> “Prediction-only” models</h3>
<p>“Prediction-only” models are analogous to $PRED models in NONMEM, which some readers may be familiar with. Here’s a very simple example - a one-compartment model with bolus dosing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">rxode2</span>({</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    ipre <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>ke <span class="sc">*</span> t);</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using C compiler: ‘Apple clang version 15.0.0 (clang-1500.0.40.1)’
using SDK: ‘’
ld: warning: -single_module is obsolete
ld: warning: -multiply_defined is obsolete</code></pre>
</div>
</div>
<p>Solving prediction-only models is done just the same way as for ODE systems, but is faster.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>et   <span class="ot">&lt;-</span> <span class="fu">et</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="at">length.out=</span><span class="dv">50</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>cmt1 <span class="ot">&lt;-</span> <span class="fu">rxSolve</span>(mod, et, <span class="at">params =</span> <span class="fu">c</span>(<span class="at">ke=</span><span class="fl">0.5</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>cmt1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>── Solved rxode2 object ──
── Parameters (x$params): ──
 ke 
0.5 
── Initial Conditions (x$inits): ──
named numeric(0)
── First part of data (object): ──
# A tibble: 50 × 2
   time  ipre
  &lt;dbl&gt; &lt;dbl&gt;
1 0     10   
2 0.490  7.83
3 0.980  6.13
4 1.47   4.80
5 1.96   3.75
6 2.45   2.94
# ℹ 44 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cmt1, <span class="fu">aes</span>(time, ipre)) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07_single_subjects_files/figure-html/pred3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="solved-systems" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="solved-systems"><span class="header-section-number">7.2.2</span> Solved systems</h3>
<p><code>rxode2</code> has a library of models which have been pre-solved, and thus do not need to be defined in terms of ODEs. These can be used by including <code>linCmt()</code> function in model code, along with a set of model parameters that fits the model you wish to use. For example:</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th><em>Model</em></th>
<th><em>Parameters</em></th>
<th><em>Microconstants</em></th>
<th><em>Hybrid constants</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>One-compartment, bolus or IV dose</td>
<td><code>cl</code>, <code>v</code></td>
<td><code>v</code>, <code>ke</code></td>
<td><code>v</code>, <code>alpha</code></td>
</tr>
<tr class="even">
<td>One-compartment, oral dose</td>
<td><code>cl</code>, <code>v</code>, <code>ka</code></td>
<td><code>v</code>, <code>ke</code>, <code>ka</code></td>
<td><code>v</code>, <code>alpha</code>, <code>ka</code></td>
</tr>
<tr class="odd">
<td>Two-compartment, bolus or IV dose</td>
<td><code>cl</code>, <code>v1</code>, <code>v2</code>, <code>q</code></td>
<td><code>v1</code>, <code>k12</code>, <code>k21</code>, <code>ke</code></td>
<td><code>v</code>, <code>alpha</code>, <code>beta</code>, <code>aob</code></td>
</tr>
<tr class="even">
<td>Two-compartment, oral dose</td>
<td><code>cl</code>, <code>v1</code>, <code>v2</code>, <code>q</code>, <code>ka</code></td>
<td><code>v1</code>, <code>k12</code>, <code>k21</code>, <code>ke</code>, <code>ka</code></td>
<td><code>v</code>, <code>alpha</code>, <code>beta</code>, <code>aob</code>, <code>ka</code></td>
</tr>
<tr class="odd">
<td>Three-compartment, bolus or IV dose</td>
<td><code>cl</code>, <code>vc</code>, <code>vp</code>, <code>vp2</code>, <code>q1</code>, <code>q2</code></td>
<td><code>v1</code>, <code>k12</code>, <code>k21</code>, <code>k13</code>, <code>k31</code>,<code>ke</code></td>
<td><code>a</code>, <code>alpha</code>, <code>b</code>, <code>beta</code>, <code>c</code>, <code>gamma</code></td>
</tr>
<tr class="even">
<td>Three-compartment, oral dose</td>
<td><code>cl</code>, <code>vc</code>, <code>vp</code>, <code>vp2</code>, <code>q1</code>, <code>q2</code>, <code>ka</code></td>
<td><code>a</code>, <code>alpha</code>, <code>b</code>, <code>beta</code>, <code>c</code>, <code>gamma</code>, <code>ka</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>Most parameters can be specified in a number of ways. For example, central volume in a one-compartment model can be called <code>v</code>, <code>v1</code> or <code>vc</code>, and will be understood as the same parameter by <code>linCmt()</code>. Here’s a very simple example…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mod_solved <span class="ot">&lt;-</span> <span class="fu">rxode2</span>({</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    ke <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    V <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    ipre <span class="ot">&lt;-</span> <span class="fu">linCmt</span>();</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using C compiler: ‘Apple clang version 15.0.0 (clang-1500.0.40.1)’
using SDK: ‘’
ld: warning: -single_module is obsolete
ld: warning: -multiply_defined is obsolete</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mod_solved</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>rxode2 2.0.14 model named rx_57aabcc3bef3848236fe152a3320cfae model (✔ ready). 
x$stateExtra: central
x$params: ke, V
x$lhs: ipre</code></pre>
</div>
</div>
<p>We can treat this the same way as an ODE model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>et  <span class="ot">&lt;-</span> <span class="fu">et</span>(<span class="at">amt=</span><span class="dv">10</span>, <span class="at">time=</span><span class="dv">0</span>, <span class="at">cmt=</span>depot) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">et</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="at">length.out=</span><span class="dv">50</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>cmt_solved <span class="ot">&lt;-</span> <span class="fu">rxSolve</span>(mod_solved, et, <span class="at">params=</span><span class="fu">c</span>(<span class="at">ke=</span><span class="fl">0.5</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>cmt_solved</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>── Solved rxode2 object ──
── Parameters (x$params): ──
 ke   V 
0.5 1.0 
── Initial Conditions (x$inits): ──
named numeric(0)
── First part of data (object): ──
# A tibble: 50 × 2
   time  ipre
  &lt;dbl&gt; &lt;dbl&gt;
1 0     10   
2 0.490  7.83
3 0.980  6.13
4 1.47   4.80
5 1.96   3.75
6 2.45   2.94
# ℹ 44 more rows</code></pre>
</div>
</div>
</section>
<section id="combining-odes-and-solved-systems" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="combining-odes-and-solved-systems"><span class="header-section-number">7.2.3</span> Combining ODEs and solved systems</h3>
<p>Solved systems and ODEs can be combined. Let’s look at our two-compartment indirect-effect model again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Set up parameters and initial conditions</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">KA   =</span> <span class="fl">0.294</span>, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">CL   =</span> <span class="fl">18.6</span>, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">V2   =</span> <span class="fl">40.2</span>, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">Q    =</span> <span class="fl">10.5</span>,  </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">V3   =</span> <span class="dv">297</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">Kin  =</span> <span class="dv">1</span>, </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">Kout =</span> <span class="dv">1</span>, </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">EC50 =</span> <span class="dv">200</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">eff =</span> <span class="dv">1</span>);</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Set up dosing event information</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>ev <span class="ot">&lt;-</span> <span class="fu">eventTable</span>(<span class="at">amount.units=</span><span class="st">'mg'</span>, <span class="at">time.units=</span><span class="st">'hours'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add.dosing</span>(<span class="at">dose=</span><span class="dv">10000</span>, <span class="at">nbr.doses=</span><span class="dv">10</span>, <span class="at">dosing.interval=</span><span class="dv">12</span>, <span class="at">dosing.to=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add.dosing</span>(<span class="at">dose=</span><span class="dv">20000</span>, <span class="at">nbr.doses=</span><span class="dv">5</span>, <span class="at">start.time=</span><span class="dv">120</span>,<span class="at">dosing.interval=</span><span class="dv">24</span>, <span class="at">dosing.to=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add.sampling</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">240</span>);</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Set up a mixed solved/ODE system</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">rxode2</span>({</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the order of variables do not matter</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the type of compartmental model is determined by the parameters specified</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    C2        <span class="ot">=</span> <span class="fu">linCmt</span>(KA, CL, V2, Q, V3);  <span class="co"># you don't need to provide the parameters, but you can if you want to</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">eff</span>(<span class="dv">0</span>)    <span class="ot">=</span> <span class="dv">1</span>  <span class="do">## The initial amount in the effect compartment is 1</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(eff) <span class="ot">=</span>  Kin <span class="sc">-</span> Kout<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> C2<span class="sc">/</span>(EC50 <span class="sc">+</span> C2))<span class="sc">*</span>eff;</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>mod2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>rxode2 2.0.14 model named rx_7f1f252ab28eab7486f3b298b1d754d8 model (✔ ready). 
x$state: eff
x$stateExtra: depot, central
x$params: CL, V2, Q, V3, KA, Kin, Kout, EC50
x$lhs: C2</code></pre>
</div>
</div>
<p>Concentration output from the 2-compartment model is assigned to the <code>C2</code> variable and is subsequently used in the indirect response model.</p>
<p>Ntoe that when mixing solved systems and ODEs, the solved system’s “compartment” is always the last one. This is because the solved system technically isn’t a compartment as such. Adding the dosing compartment to the end will not interfere with the actual ODE to be solved.</p>
<p>In this example, therefore, the effect compartment is compartment #1 while the PK dosing compartment for the depot is compartment #2.</p>
<p>Let’s solve the system and see what it looks like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> mod2 <span class="sc">%&gt;%</span>  <span class="fu">solve</span>(theta, ev)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>── Solved rxode2 object ──
── Parameters ($params): ──
     CL      V2       Q      V3      KA     Kin    Kout    EC50 
 18.600  40.200  10.500 297.000   0.294   1.000   1.000 200.000 
── Initial Conditions ($inits): ──
eff 
  1 
── First part of data (object): ──
# A tibble: 241 × 3
   time    C2   eff
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     0 249.      1
2     1 121.      1
3     2  60.3     1
4     3  31.0     1
5     4  17.0     1
6     5  10.2     1
# ℹ 235 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(x, <span class="fu">aes</span>(time, C2)) <span class="sc">+</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Concentration"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(x, <span class="fu">aes</span>(time, eff)) <span class="sc">+</span>   </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Effect"</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">nrow=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07_single_subjects_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="compartment-numbers" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="compartment-numbers"><span class="header-section-number">7.3</span> Compartment numbers</h2>
<p>rxode2 automatically assigns compartment numbers when parsing. For illustrative purposes, elt’s look at something a bit more compex than we have so far: a PBPK model for mavoglurant published by Wendling and colleagues <span class="citation" data-cites="Wendling2016">(<a href="references.html#ref-Wendling2016" role="doc-biblioref">2</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rxode2)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>pbpk <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>({</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    KbBR <span class="ot">=</span> <span class="fu">exp</span>(lKbBR)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    KbMU <span class="ot">=</span> <span class="fu">exp</span>(lKbMU)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    KbAD <span class="ot">=</span> <span class="fu">exp</span>(lKbAD)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    CLint<span class="ot">=</span> <span class="fu">exp</span>(lCLint <span class="sc">+</span> eta.LClint)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    KbBO <span class="ot">=</span> <span class="fu">exp</span>(lKbBO)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    KbRB <span class="ot">=</span> <span class="fu">exp</span>(lKbRB)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Regional blood flows</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cardiac output (L/h) from White et al (1968)</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    CO  <span class="ot">=</span> (<span class="fl">187.00</span><span class="sc">*</span>WT<span class="sc">^</span><span class="fl">0.81</span>)<span class="sc">*</span><span class="dv">60</span><span class="sc">/</span><span class="dv">1000</span> </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    QHT <span class="ot">=</span> <span class="fl">4.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    QBR <span class="ot">=</span> <span class="fl">12.0</span><span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    QMU <span class="ot">=</span> <span class="fl">17.0</span><span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    QAD <span class="ot">=</span> <span class="fl">5.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    QSK <span class="ot">=</span> <span class="fl">5.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    QSP <span class="ot">=</span> <span class="fl">3.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    QPA <span class="ot">=</span> <span class="fl">1.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    QLI <span class="ot">=</span> <span class="fl">25.5</span><span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    QST <span class="ot">=</span> <span class="fl">1.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    QGU <span class="ot">=</span> <span class="fl">14.0</span><span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hepatic artery blood flow</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    QHA <span class="ot">=</span> QLI <span class="sc">-</span> (QSP <span class="sc">+</span> QPA <span class="sc">+</span> QST <span class="sc">+</span> QGU) </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    QBO <span class="ot">=</span> <span class="fl">5.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    QKI <span class="ot">=</span> <span class="fl">19.0</span><span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    QRB <span class="ot">=</span> CO <span class="sc">-</span> (QHT <span class="sc">+</span> QBR <span class="sc">+</span> QMU <span class="sc">+</span> QAD <span class="sc">+</span> QSK <span class="sc">+</span> QLI <span class="sc">+</span> QBO <span class="sc">+</span> QKI)</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>    QLU <span class="ot">=</span> QHT <span class="sc">+</span> QBR <span class="sc">+</span> QMU <span class="sc">+</span> QAD <span class="sc">+</span> QSK <span class="sc">+</span> QLI <span class="sc">+</span> QBO <span class="sc">+</span> QKI <span class="sc">+</span> QRB</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Organs' volumes = organs' weights / organs' density</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>    VLU <span class="ot">=</span> (<span class="fl">0.76</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.051</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>    VHT <span class="ot">=</span> (<span class="fl">0.47</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.030</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>    VBR <span class="ot">=</span> (<span class="fl">2.00</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.036</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>    VMU <span class="ot">=</span> (<span class="fl">40.00</span><span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.041</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>    VAD <span class="ot">=</span> (<span class="fl">21.42</span><span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">0.916</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>    VSK <span class="ot">=</span> (<span class="fl">3.71</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.116</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>    VSP <span class="ot">=</span> (<span class="fl">0.26</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.054</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>    VPA <span class="ot">=</span> (<span class="fl">0.14</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.045</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>    VLI <span class="ot">=</span> (<span class="fl">2.57</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.040</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>    VST <span class="ot">=</span> (<span class="fl">0.21</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.050</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>    VGU <span class="ot">=</span> (<span class="fl">1.44</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.043</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>    VBO <span class="ot">=</span> (<span class="fl">14.29</span><span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.990</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>    VKI <span class="ot">=</span> (<span class="fl">0.44</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.050</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>    VAB <span class="ot">=</span> (<span class="fl">2.81</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.040</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>    VVB <span class="ot">=</span> (<span class="fl">5.62</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.040</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>    VRB <span class="ot">=</span> (<span class="fl">3.86</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.040</span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Fixed parameters</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>    BP <span class="ot">=</span> <span class="fl">0.61</span>      <span class="co"># Blood:plasma partition coefficient</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>    fup <span class="ot">=</span> <span class="fl">0.028</span>    <span class="co"># Fraction unbound in plasma</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>    fub <span class="ot">=</span> fup<span class="sc">/</span>BP   <span class="co"># Fraction unbound in blood</span></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>    KbLU <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">0.8334</span>)</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>    KbHT <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">1.1205</span>)</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>    KbSK <span class="ot">=</span> <span class="fu">exp</span>(<span class="sc">-</span>.<span class="dv">5238</span>)</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>    KbSP <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">0.3224</span>)</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>    KbPA <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">0.3224</span>)</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>    KbLI <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">1.7604</span>)</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>    KbST <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">0.3224</span>)</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>    KbGU <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">1.2026</span>)</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>    KbKI <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">1.3171</span>)</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>    <span class="do">##-----------------------------------------</span></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>    S15 <span class="ot">=</span> VVB<span class="sc">*</span>BP<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>    C15 <span class="ot">=</span> Venous_Blood<span class="sc">/</span>S15</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>    <span class="do">##-----------------------------------------</span></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Lungs) <span class="ot">=</span> QLU<span class="sc">*</span>(Venous_Blood<span class="sc">/</span>VVB <span class="sc">-</span> Lungs<span class="sc">/</span>KbLU<span class="sc">/</span>VLU)</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Heart) <span class="ot">=</span> QHT<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Heart<span class="sc">/</span>KbHT<span class="sc">/</span>VHT)</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Brain) <span class="ot">=</span> QBR<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Brain<span class="sc">/</span>KbBR<span class="sc">/</span>VBR)</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Muscles) <span class="ot">=</span> QMU<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Muscles<span class="sc">/</span>KbMU<span class="sc">/</span>VMU)</span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Adipose) <span class="ot">=</span> QAD<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Adipose<span class="sc">/</span>KbAD<span class="sc">/</span>VAD)</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Skin) <span class="ot">=</span> QSK<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Skin<span class="sc">/</span>KbSK<span class="sc">/</span>VSK)</span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Spleen) <span class="ot">=</span> QSP<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Spleen<span class="sc">/</span>KbSP<span class="sc">/</span>VSP)</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Pancreas) <span class="ot">=</span> QPA<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Pancreas<span class="sc">/</span>KbPA<span class="sc">/</span>VPA)</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Liver) <span class="ot">=</span> QHA<span class="sc">*</span>Arterial_Blood<span class="sc">/</span>VAB <span class="sc">+</span> QSP<span class="sc">*</span>Spleen<span class="sc">/</span>KbSP<span class="sc">/</span>VSP <span class="sc">+</span></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>      QPA<span class="sc">*</span>Pancreas<span class="sc">/</span>KbPA<span class="sc">/</span>VPA <span class="sc">+</span> QST<span class="sc">*</span>Stomach<span class="sc">/</span>KbST<span class="sc">/</span>VST <span class="sc">+</span></span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a>      QGU<span class="sc">*</span>Gut<span class="sc">/</span>KbGU<span class="sc">/</span>VGU <span class="sc">-</span> CLint<span class="sc">*</span>fub<span class="sc">*</span>Liver<span class="sc">/</span>KbLI<span class="sc">/</span>VLI <span class="sc">-</span> QLI<span class="sc">*</span>Liver<span class="sc">/</span>KbLI<span class="sc">/</span>VLI</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Stomach) <span class="ot">=</span> QST<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Stomach<span class="sc">/</span>KbST<span class="sc">/</span>VST)</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Gut) <span class="ot">=</span> QGU<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Gut<span class="sc">/</span>KbGU<span class="sc">/</span>VGU)</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Bones) <span class="ot">=</span> QBO<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Bones<span class="sc">/</span>KbBO<span class="sc">/</span>VBO)</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Kidneys) <span class="ot">=</span> QKI<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Kidneys<span class="sc">/</span>KbKI<span class="sc">/</span>VKI)</span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Arterial_Blood) <span class="ot">=</span> QLU<span class="sc">*</span>(Lungs<span class="sc">/</span>KbLU<span class="sc">/</span>VLU <span class="sc">-</span> Arterial_Blood<span class="sc">/</span>VAB)</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Venous_Blood) <span class="ot">=</span> QHT<span class="sc">*</span>Heart<span class="sc">/</span>KbHT<span class="sc">/</span>VHT <span class="sc">+</span> QBR<span class="sc">*</span>Brain<span class="sc">/</span>KbBR<span class="sc">/</span>VBR <span class="sc">+</span></span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>      QMU<span class="sc">*</span>Muscles<span class="sc">/</span>KbMU<span class="sc">/</span>VMU <span class="sc">+</span> QAD<span class="sc">*</span>Adipose<span class="sc">/</span>KbAD<span class="sc">/</span>VAD <span class="sc">+</span> QSK<span class="sc">*</span>Skin<span class="sc">/</span>KbSK<span class="sc">/</span>VSK <span class="sc">+</span></span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a>      QLI<span class="sc">*</span>Liver<span class="sc">/</span>KbLI<span class="sc">/</span>VLI <span class="sc">+</span> QBO<span class="sc">*</span>Bones<span class="sc">/</span>KbBO<span class="sc">/</span>VBO <span class="sc">+</span> QKI<span class="sc">*</span>Kidneys<span class="sc">/</span>KbKI<span class="sc">/</span>VKI <span class="sc">+</span></span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>      QRB<span class="sc">*</span>Rest_of_Body<span class="sc">/</span>KbRB<span class="sc">/</span>VRB <span class="sc">-</span> QLU<span class="sc">*</span>Venous_Blood<span class="sc">/</span>VVB</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Rest_of_Body) <span class="ot">=</span> QRB<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Rest_of_Body<span class="sc">/</span>KbRB<span class="sc">/</span>VRB)</span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is quite a meaty model, with 16 compartments linked by ODEs.</p>
<p><img src="Wendling2016.jpg" class="img-fluid"></p>
<section id="how-rxode2-assigns-compartment-numbers" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="how-rxode2-assigns-compartment-numbers"><span class="header-section-number">7.3.1</span> How <code>rxode2</code> assigns compartment numbers</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pbpk <span class="ot">&lt;-</span> <span class="fu">pbpk</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pbpk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> ── rxode2-based free-form 16-cmt ODE model ───────────────────────────────────── 

States ($state or $stateDf): 
   Compartment Number Compartment Name
1                   1            Lungs
2                   2            Heart
3                   3            Brain
4                   4          Muscles
5                   5          Adipose
6                   6             Skin
7                   7           Spleen
8                   8         Pancreas
9                   9            Liver
10                 10          Stomach
11                 11              Gut
12                 12            Bones
13                 13          Kidneys
14                 14   Arterial_Blood
15                 15     Venous_Blood
16                 16     Rest_of_Body
 ── Model (Normalized Syntax): ── 
function() {
    model({
        KbBR = exp(lKbBR)
        KbMU = exp(lKbMU)
        KbAD = exp(lKbAD)
        CLint = exp(lCLint + eta.LClint)
        KbBO = exp(lKbBO)
        KbRB = exp(lKbRB)
        CO = (187 * WT^0.81) * 60/1000
        QHT = 4 * CO/100
        QBR = 12 * CO/100
        QMU = 17 * CO/100
        QAD = 5 * CO/100
        QSK = 5 * CO/100
        QSP = 3 * CO/100
        QPA = 1 * CO/100
        QLI = 25.5 * CO/100
        QST = 1 * CO/100
        QGU = 14 * CO/100
        QHA = QLI - (QSP + QPA + QST + QGU)
        QBO = 5 * CO/100
        QKI = 19 * CO/100
        QRB = CO - (QHT + QBR + QMU + QAD + QSK + QLI + QBO + 
            QKI)
        QLU = QHT + QBR + QMU + QAD + QSK + QLI + QBO + QKI + 
            QRB
        VLU = (0.76 * WT/100)/1.051
        VHT = (0.47 * WT/100)/1.03
        VBR = (2 * WT/100)/1.036
        VMU = (40 * WT/100)/1.041
        VAD = (21.42 * WT/100)/0.916
        VSK = (3.71 * WT/100)/1.116
        VSP = (0.26 * WT/100)/1.054
        VPA = (0.14 * WT/100)/1.045
        VLI = (2.57 * WT/100)/1.04
        VST = (0.21 * WT/100)/1.05
        VGU = (1.44 * WT/100)/1.043
        VBO = (14.29 * WT/100)/1.99
        VKI = (0.44 * WT/100)/1.05
        VAB = (2.81 * WT/100)/1.04
        VVB = (5.62 * WT/100)/1.04
        VRB = (3.86 * WT/100)/1.04
        BP = 0.61
        fup = 0.028
        fub = fup/BP
        KbLU = exp(0.8334)
        KbHT = exp(1.1205)
        KbSK = exp(-0.5238)
        KbSP = exp(0.3224)
        KbPA = exp(0.3224)
        KbLI = exp(1.7604)
        KbST = exp(0.3224)
        KbGU = exp(1.2026)
        KbKI = exp(1.3171)
        S15 = VVB * BP/1000
        C15 = Venous_Blood/S15
        d/dt(Lungs) = QLU * (Venous_Blood/VVB - Lungs/KbLU/VLU)
        d/dt(Heart) = QHT * (Arterial_Blood/VAB - Heart/KbHT/VHT)
        d/dt(Brain) = QBR * (Arterial_Blood/VAB - Brain/KbBR/VBR)
        d/dt(Muscles) = QMU * (Arterial_Blood/VAB - Muscles/KbMU/VMU)
        d/dt(Adipose) = QAD * (Arterial_Blood/VAB - Adipose/KbAD/VAD)
        d/dt(Skin) = QSK * (Arterial_Blood/VAB - Skin/KbSK/VSK)
        d/dt(Spleen) = QSP * (Arterial_Blood/VAB - Spleen/KbSP/VSP)
        d/dt(Pancreas) = QPA * (Arterial_Blood/VAB - Pancreas/KbPA/VPA)
        d/dt(Liver) = QHA * Arterial_Blood/VAB + QSP * Spleen/KbSP/VSP + 
            QPA * Pancreas/KbPA/VPA + QST * Stomach/KbST/VST + 
            QGU * Gut/KbGU/VGU - CLint * fub * Liver/KbLI/VLI - 
            QLI * Liver/KbLI/VLI
        d/dt(Stomach) = QST * (Arterial_Blood/VAB - Stomach/KbST/VST)
        d/dt(Gut) = QGU * (Arterial_Blood/VAB - Gut/KbGU/VGU)
        d/dt(Bones) = QBO * (Arterial_Blood/VAB - Bones/KbBO/VBO)
        d/dt(Kidneys) = QKI * (Arterial_Blood/VAB - Kidneys/KbKI/VKI)
        d/dt(Arterial_Blood) = QLU * (Lungs/KbLU/VLU - Arterial_Blood/VAB)
        d/dt(Venous_Blood) = QHT * Heart/KbHT/VHT + QBR * Brain/KbBR/VBR + 
            QMU * Muscles/KbMU/VMU + QAD * Adipose/KbAD/VAD + 
            QSK * Skin/KbSK/VSK + QLI * Liver/KbLI/VLI + QBO * 
            Bones/KbBO/VBO + QKI * Kidneys/KbKI/VKI + QRB * Rest_of_Body/KbRB/VRB - 
            QLU * Venous_Blood/VVB
        d/dt(Rest_of_Body) = QRB * (Arterial_Blood/VAB - Rest_of_Body/KbRB/VRB)
    })
}</code></pre>
</div>
</div>
<p>Here, <code>Venous_Blood</code> is assigned to compartment 15. Keeping track of compartment numbers in large models like this can be inconvenient and challenging, and more importantly, can lead to mistakes. While it is easy, and probably clearer, to specify the compartments by name rather than number, other pharmacometric software in common use only supports compartment numbers. Having a way to number compartments easily can therefore be handy when moving between different tools.</p>
</section>
<section id="pre-declaring-the-compartments" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="pre-declaring-the-compartments"><span class="header-section-number">7.3.2</span> Pre-declaring the compartments</h3>
<p>Pre-assigning compartment numbers can be helpful in this situation.</p>
<p>To add the compartments to the model in the order desired, we can pre-declare them with <code>cmt</code>. For example, specifying <code>Venous_Blood</code> and <code>Skin</code> as the first and second compartments, respectively, is pretty straightforward:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pbpk2 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>({</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cmt</span>(Venous_Blood)  <span class="do">## Now this is the first compartment, ie cmt=1</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cmt</span>(Skin)          <span class="do">## Now this is the second compartment, ie cmt=2</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    KbBR <span class="ot">=</span> <span class="fu">exp</span>(lKbBR)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    KbMU <span class="ot">=</span> <span class="fu">exp</span>(lKbMU)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    KbAD <span class="ot">=</span> <span class="fu">exp</span>(lKbAD)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    CLint<span class="ot">=</span> <span class="fu">exp</span>(lCLint <span class="sc">+</span> eta.LClint)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    KbBO <span class="ot">=</span> <span class="fu">exp</span>(lKbBO)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    KbRB <span class="ot">=</span> <span class="fu">exp</span>(lKbRB)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Regional blood flows</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cardiac output (L/h) from White et al (1968)m</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    CO  <span class="ot">=</span> (<span class="fl">187.00</span><span class="sc">*</span>WT<span class="sc">^</span><span class="fl">0.81</span>)<span class="sc">*</span><span class="dv">60</span><span class="sc">/</span><span class="dv">1000</span>;</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    QHT <span class="ot">=</span> <span class="fl">4.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    QBR <span class="ot">=</span> <span class="fl">12.0</span><span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    QMU <span class="ot">=</span> <span class="fl">17.0</span><span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    QAD <span class="ot">=</span> <span class="fl">5.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    QSK <span class="ot">=</span> <span class="fl">5.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    QSP <span class="ot">=</span> <span class="fl">3.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    QPA <span class="ot">=</span> <span class="fl">1.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    QLI <span class="ot">=</span> <span class="fl">25.5</span><span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    QST <span class="ot">=</span> <span class="fl">1.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    QGU <span class="ot">=</span> <span class="fl">14.0</span><span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    QHA <span class="ot">=</span> QLI <span class="sc">-</span> (QSP <span class="sc">+</span> QPA <span class="sc">+</span> QST <span class="sc">+</span> QGU); <span class="co"># Hepatic artery blood flow</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    QBO <span class="ot">=</span> <span class="fl">5.0</span> <span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    QKI <span class="ot">=</span> <span class="fl">19.0</span><span class="sc">*</span>CO<span class="sc">/</span><span class="dv">100</span>;</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    QRB <span class="ot">=</span> CO <span class="sc">-</span> (QHT <span class="sc">+</span> QBR <span class="sc">+</span> QMU <span class="sc">+</span> QAD <span class="sc">+</span> QSK <span class="sc">+</span> QLI <span class="sc">+</span> QBO <span class="sc">+</span> QKI);</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    QLU <span class="ot">=</span> QHT <span class="sc">+</span> QBR <span class="sc">+</span> QMU <span class="sc">+</span> QAD <span class="sc">+</span> QSK <span class="sc">+</span> QLI <span class="sc">+</span> QBO <span class="sc">+</span> QKI <span class="sc">+</span> QRB;</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Organs' volumes = organs' weights / organs' density</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    VLU <span class="ot">=</span> (<span class="fl">0.76</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.051</span>;</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    VHT <span class="ot">=</span> (<span class="fl">0.47</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.030</span>;</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    VBR <span class="ot">=</span> (<span class="fl">2.00</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.036</span>;</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    VMU <span class="ot">=</span> (<span class="fl">40.00</span><span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.041</span>;</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    VAD <span class="ot">=</span> (<span class="fl">21.42</span><span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">0.916</span>;</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    VSK <span class="ot">=</span> (<span class="fl">3.71</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.116</span>;</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    VSP <span class="ot">=</span> (<span class="fl">0.26</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.054</span>;</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    VPA <span class="ot">=</span> (<span class="fl">0.14</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.045</span>;</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    VLI <span class="ot">=</span> (<span class="fl">2.57</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.040</span>;</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    VST <span class="ot">=</span> (<span class="fl">0.21</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.050</span>;</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    VGU <span class="ot">=</span> (<span class="fl">1.44</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.043</span>;</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    VBO <span class="ot">=</span> (<span class="fl">14.29</span><span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.990</span>;</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    VKI <span class="ot">=</span> (<span class="fl">0.44</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.050</span>;</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>    VAB <span class="ot">=</span> (<span class="fl">2.81</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.040</span>;</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>    VVB <span class="ot">=</span> (<span class="fl">5.62</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.040</span>;</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>    VRB <span class="ot">=</span> (<span class="fl">3.86</span> <span class="sc">*</span>WT<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="fl">1.040</span>;</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Fixed parameters</span></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>    BP <span class="ot">=</span> <span class="fl">0.61</span>;      <span class="co"># Blood:plasma partition coefficient</span></span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>    fup <span class="ot">=</span> <span class="fl">0.028</span>;    <span class="co"># Fraction unbound in plasma</span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>    fub <span class="ot">=</span> fup<span class="sc">/</span>BP;   <span class="co"># Fraction unbound in blood</span></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>    KbLU <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">0.8334</span>);</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>    KbHT <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">1.1205</span>);</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>    KbSK <span class="ot">=</span> <span class="fu">exp</span>(<span class="sc">-</span>.<span class="dv">5238</span>);</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>    KbSP <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">0.3224</span>);</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>    KbPA <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">0.3224</span>);</span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>    KbLI <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">1.7604</span>);</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>    KbST <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">0.3224</span>);</span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>    KbGU <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">1.2026</span>);</span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>    KbKI <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">1.3171</span>);</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>    <span class="do">##-----------------------------------------</span></span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>    S15 <span class="ot">=</span> VVB<span class="sc">*</span>BP<span class="sc">/</span><span class="dv">1000</span>;</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>    C15 <span class="ot">=</span> Venous_Blood<span class="sc">/</span>S15</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>    <span class="do">##-----------------------------------------</span></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Lungs) <span class="ot">=</span> QLU<span class="sc">*</span>(Venous_Blood<span class="sc">/</span>VVB <span class="sc">-</span> Lungs<span class="sc">/</span>KbLU<span class="sc">/</span>VLU);</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Heart) <span class="ot">=</span> QHT<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Heart<span class="sc">/</span>KbHT<span class="sc">/</span>VHT);</span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Brain) <span class="ot">=</span> QBR<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Brain<span class="sc">/</span>KbBR<span class="sc">/</span>VBR);</span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Muscles) <span class="ot">=</span> QMU<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Muscles<span class="sc">/</span>KbMU<span class="sc">/</span>VMU);</span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Adipose) <span class="ot">=</span> QAD<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Adipose<span class="sc">/</span>KbAD<span class="sc">/</span>VAD);</span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Skin) <span class="ot">=</span> QSK<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Skin<span class="sc">/</span>KbSK<span class="sc">/</span>VSK);</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Spleen) <span class="ot">=</span> QSP<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Spleen<span class="sc">/</span>KbSP<span class="sc">/</span>VSP);</span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Pancreas) <span class="ot">=</span> QPA<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Pancreas<span class="sc">/</span>KbPA<span class="sc">/</span>VPA);</span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(Liver) <span class="ot">=</span> QHA<span class="sc">*</span>Arterial_Blood<span class="sc">/</span>VAB <span class="sc">+</span> QSP<span class="sc">*</span>Spleen<span class="sc">/</span>KbSP<span class="sc">/</span>VSP <span class="sc">+</span></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a>      QPA<span class="sc">*</span>Pancreas<span class="sc">/</span>KbPA<span class="sc">/</span>VPA <span class="sc">+</span> QST<span class="sc">*</span>Stomach<span class="sc">/</span>KbST<span class="sc">/</span>VST <span class="sc">+</span> QGU<span class="sc">*</span>Gut<span class="sc">/</span>KbGU<span class="sc">/</span>VGU <span class="sc">-</span></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>      CLint<span class="sc">*</span>fub<span class="sc">*</span>Liver<span class="sc">/</span>KbLI<span class="sc">/</span>VLI <span class="sc">-</span> QLI<span class="sc">*</span>Liver<span class="sc">/</span>KbLI<span class="sc">/</span>VLI;</span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>      d<span class="sc">/</span><span class="fu">dt</span>(Stomach) <span class="ot">=</span> QST<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Stomach<span class="sc">/</span>KbST<span class="sc">/</span>VST);</span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a>      d<span class="sc">/</span><span class="fu">dt</span>(Gut) <span class="ot">=</span> QGU<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Gut<span class="sc">/</span>KbGU<span class="sc">/</span>VGU);</span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>      d<span class="sc">/</span><span class="fu">dt</span>(Bones) <span class="ot">=</span> QBO<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Bones<span class="sc">/</span>KbBO<span class="sc">/</span>VBO);</span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>      d<span class="sc">/</span><span class="fu">dt</span>(Kidneys) <span class="ot">=</span> QKI<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Kidneys<span class="sc">/</span>KbKI<span class="sc">/</span>VKI);</span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a>      d<span class="sc">/</span><span class="fu">dt</span>(Arterial_Blood) <span class="ot">=</span> QLU<span class="sc">*</span>(Lungs<span class="sc">/</span>KbLU<span class="sc">/</span>VLU <span class="sc">-</span> Arterial_Blood<span class="sc">/</span>VAB);</span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a>      d<span class="sc">/</span><span class="fu">dt</span>(Venous_Blood) <span class="ot">=</span> QHT<span class="sc">*</span>Heart<span class="sc">/</span>KbHT<span class="sc">/</span>VHT <span class="sc">+</span> QBR<span class="sc">*</span>Brain<span class="sc">/</span>KbBR<span class="sc">/</span>VBR <span class="sc">+</span></span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a>        QMU<span class="sc">*</span>Muscles<span class="sc">/</span>KbMU<span class="sc">/</span>VMU <span class="sc">+</span> QAD<span class="sc">*</span>Adipose<span class="sc">/</span>KbAD<span class="sc">/</span>VAD <span class="sc">+</span> QSK<span class="sc">*</span>Skin<span class="sc">/</span>KbSK<span class="sc">/</span>VSK <span class="sc">+</span></span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a>        QLI<span class="sc">*</span>Liver<span class="sc">/</span>KbLI<span class="sc">/</span>VLI <span class="sc">+</span> QBO<span class="sc">*</span>Bones<span class="sc">/</span>KbBO<span class="sc">/</span>VBO <span class="sc">+</span> QKI<span class="sc">*</span>Kidneys<span class="sc">/</span>KbKI<span class="sc">/</span>VKI <span class="sc">+</span></span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a>        QRB<span class="sc">*</span>Rest_of_Body<span class="sc">/</span>KbRB<span class="sc">/</span>VRB <span class="sc">-</span> QLU<span class="sc">*</span>Venous_Blood<span class="sc">/</span>VVB;</span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a>        d<span class="sc">/</span><span class="fu">dt</span>(Rest_of_Body) <span class="ot">=</span> QRB<span class="sc">*</span>(Arterial_Blood<span class="sc">/</span>VAB <span class="sc">-</span> Rest_of_Body<span class="sc">/</span>KbRB<span class="sc">/</span>VRB);</span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pbpk2 <span class="ot">&lt;-</span> <span class="fu">pbpk2</span>()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>pbpk2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> ── rxode2-based free-form 16-cmt ODE model ───────────────────────────────────── 

States ($state or $stateDf): 
   Compartment Number Compartment Name
1                   1     Venous_Blood
2                   2             Skin
3                   3            Lungs
4                   4            Heart
5                   5            Brain
6                   6          Muscles
7                   7          Adipose
8                   8           Spleen
9                   9         Pancreas
10                 10            Liver
11                 11          Stomach
12                 12              Gut
13                 13            Bones
14                 14          Kidneys
15                 15   Arterial_Blood
16                 16     Rest_of_Body
 ── Model (Normalized Syntax): ── 
function() {
    model({
        cmt(Venous_Blood)
        cmt(Skin)
        KbBR = exp(lKbBR)
        KbMU = exp(lKbMU)
        KbAD = exp(lKbAD)
        CLint = exp(lCLint + eta.LClint)
        KbBO = exp(lKbBO)
        KbRB = exp(lKbRB)
        CO = (187 * WT^0.81) * 60/1000
        QHT = 4 * CO/100
        QBR = 12 * CO/100
        QMU = 17 * CO/100
        QAD = 5 * CO/100
        QSK = 5 * CO/100
        QSP = 3 * CO/100
        QPA = 1 * CO/100
        QLI = 25.5 * CO/100
        QST = 1 * CO/100
        QGU = 14 * CO/100
        QHA = QLI - (QSP + QPA + QST + QGU)
        QBO = 5 * CO/100
        QKI = 19 * CO/100
        QRB = CO - (QHT + QBR + QMU + QAD + QSK + QLI + QBO + 
            QKI)
        QLU = QHT + QBR + QMU + QAD + QSK + QLI + QBO + QKI + 
            QRB
        VLU = (0.76 * WT/100)/1.051
        VHT = (0.47 * WT/100)/1.03
        VBR = (2 * WT/100)/1.036
        VMU = (40 * WT/100)/1.041
        VAD = (21.42 * WT/100)/0.916
        VSK = (3.71 * WT/100)/1.116
        VSP = (0.26 * WT/100)/1.054
        VPA = (0.14 * WT/100)/1.045
        VLI = (2.57 * WT/100)/1.04
        VST = (0.21 * WT/100)/1.05
        VGU = (1.44 * WT/100)/1.043
        VBO = (14.29 * WT/100)/1.99
        VKI = (0.44 * WT/100)/1.05
        VAB = (2.81 * WT/100)/1.04
        VVB = (5.62 * WT/100)/1.04
        VRB = (3.86 * WT/100)/1.04
        BP = 0.61
        fup = 0.028
        fub = fup/BP
        KbLU = exp(0.8334)
        KbHT = exp(1.1205)
        KbSK = exp(-0.5238)
        KbSP = exp(0.3224)
        KbPA = exp(0.3224)
        KbLI = exp(1.7604)
        KbST = exp(0.3224)
        KbGU = exp(1.2026)
        KbKI = exp(1.3171)
        S15 = VVB * BP/1000
        C15 = Venous_Blood/S15
        d/dt(Lungs) = QLU * (Venous_Blood/VVB - Lungs/KbLU/VLU)
        d/dt(Heart) = QHT * (Arterial_Blood/VAB - Heart/KbHT/VHT)
        d/dt(Brain) = QBR * (Arterial_Blood/VAB - Brain/KbBR/VBR)
        d/dt(Muscles) = QMU * (Arterial_Blood/VAB - Muscles/KbMU/VMU)
        d/dt(Adipose) = QAD * (Arterial_Blood/VAB - Adipose/KbAD/VAD)
        d/dt(Skin) = QSK * (Arterial_Blood/VAB - Skin/KbSK/VSK)
        d/dt(Spleen) = QSP * (Arterial_Blood/VAB - Spleen/KbSP/VSP)
        d/dt(Pancreas) = QPA * (Arterial_Blood/VAB - Pancreas/KbPA/VPA)
        d/dt(Liver) = QHA * Arterial_Blood/VAB + QSP * Spleen/KbSP/VSP + 
            QPA * Pancreas/KbPA/VPA + QST * Stomach/KbST/VST + 
            QGU * Gut/KbGU/VGU - CLint * fub * Liver/KbLI/VLI - 
            QLI * Liver/KbLI/VLI
        d/dt(Stomach) = QST * (Arterial_Blood/VAB - Stomach/KbST/VST)
        d/dt(Gut) = QGU * (Arterial_Blood/VAB - Gut/KbGU/VGU)
        d/dt(Bones) = QBO * (Arterial_Blood/VAB - Bones/KbBO/VBO)
        d/dt(Kidneys) = QKI * (Arterial_Blood/VAB - Kidneys/KbKI/VKI)
        d/dt(Arterial_Blood) = QLU * (Lungs/KbLU/VLU - Arterial_Blood/VAB)
        d/dt(Venous_Blood) = QHT * Heart/KbHT/VHT + QBR * Brain/KbBR/VBR + 
            QMU * Muscles/KbMU/VMU + QAD * Adipose/KbAD/VAD + 
            QSK * Skin/KbSK/VSK + QLI * Liver/KbLI/VLI + QBO * 
            Bones/KbBO/VBO + QKI * Kidneys/KbKI/VKI + QRB * Rest_of_Body/KbRB/VRB - 
            QLU * Venous_Blood/VVB
        d/dt(Rest_of_Body) = QRB * (Arterial_Blood/VAB - Rest_of_Body/KbRB/VRB)
    })
}</code></pre>
</div>
</div>
<p>Now <code>Venous_Blood</code> and <code>Skin</code> are where we want them.</p>
</section>
<section id="appending-compartments" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3" class="anchored" data-anchor-id="appending-compartments"><span class="header-section-number">7.3.3</span> Appending compartments</h3>
<p>You can also append “compartments” to the model. Because of the ODE solving internals, you cannot add fake compartments to the model until after all the differential equations are defined.</p>
<p>For example this is legal:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>({</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    C2 <span class="ot">=</span> center<span class="sc">/</span>V</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    d <span class="sc">/</span> <span class="fu">dt</span>(depot) <span class="ot">=</span> <span class="sc">-</span>KA <span class="sc">*</span> depot</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(center) <span class="ot">=</span> KA <span class="sc">*</span> depot <span class="sc">-</span> CL<span class="sc">*</span>C2</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cmt</span>(eff)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">mod2</span>()</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> ── rxode2-based free-form 2-cmt ODE model ────────────────────────────────────── 

States ($state or $stateDf): 
  Compartment Number Compartment Name
1                  1            depot
2                  2           center
 ── Model (Normalized Syntax): ── 
function() {
    model({
        C2 = center/V
        d/dt(depot) = -KA * depot
        d/dt(center) = KA * depot - CL * C2
        cmt(eff)
    })
}</code></pre>
</div>
</div>
<p>You can see this more clearly by querying the <code>simulationModel</code> property:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>mod2<span class="sc">$</span>simulationModel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using C compiler: ‘Apple clang version 15.0.0 (clang-1500.0.40.1)’
using SDK: ‘’
ld: warning: -single_module is obsolete
ld: warning: -multiply_defined is obsolete</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>rxode2 2.0.14 model named rx_beefd30f33bb9cd4324bb242420aa74f model (✔ ready). 
x$state: depot, center
x$stateExtra: eff
x$params: V, KA, CL
x$lhs: C2</code></pre>
</div>
</div>
<p>Defining “extra” compartments before the differential equations is not supported. The model below will throw an error if executed.</p>
<pre><code>mod2 &lt;- rxode2({
    cmt(eff)
    C2 = center/V;
    d / dt(depot) = -KA * depot
    d/dt(center) = KA * depot - CL*C2
})</code></pre>
</section>
</section>
<section id="transit-compartments" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="transit-compartments"><span class="header-section-number">7.4</span> Transit compartments</h2>
<p>Transit compartments provide a useful way to better approximate absorption lag times, without the numerical problems and stiffness associated with the conventional way of modeling these <span class="citation" data-cites="Savic2007 Wilkins2008">(<a href="references.html#ref-Savic2007" role="doc-biblioref">3</a>,<a href="references.html#ref-Wilkins2008" role="doc-biblioref">4</a>)</span>. <code>rxode2</code> has them built in.</p>
<p>The transit compartment function (<code>transit</code>) can be used to specify the model without having to write it out in full (although you could do that too, if you wanted to). <code>transit()</code> takes parameters corresponding to the number of transit compartments (<code>n</code> in the code below), the mean transit time (<code>mtt</code>), and bioavailability (<code>bio</code>, which is optional).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ini</span>({</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Table 3 from Savic 2007</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    cl  <span class="ot">&lt;-</span> <span class="fl">17.2</span> <span class="co"># (L/hr)</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    vc  <span class="ot">&lt;-</span> <span class="fl">45.1</span> <span class="co"># L</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    ka  <span class="ot">&lt;-</span> <span class="fl">0.38</span> <span class="co"># 1/hr</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    mtt <span class="ot">&lt;-</span> <span class="fl">0.37</span> <span class="co"># hr</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    bio <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    n   <span class="ot">&lt;-</span> <span class="fl">20.1</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>({</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    k           <span class="ot">&lt;-</span> cl<span class="sc">/</span>vc</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    ktr         <span class="ot">&lt;-</span> (n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span>mtt</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(depot) <span class="ot">&lt;-</span> <span class="fu">transit</span>(n,mtt,bio)<span class="sc">-</span>ka<span class="sc">*</span>depot</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># or alternately -</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># d/dt(depot) &lt;- exp(log(bio*podo(depot))+log(ktr)+n*log(ktr*tad(depot))-</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                    ktr*tad(depot)-lgammafn(n+1))-ka*depot</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    d<span class="sc">/</span><span class="fu">dt</span>(cen)   <span class="ot">&lt;-</span> ka<span class="sc">*</span>depot<span class="sc">-</span>k<span class="sc">*</span>cen</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>et <span class="ot">&lt;-</span> <span class="fu">et</span>(<span class="dv">0</span>, <span class="dv">7</span>, <span class="at">length.out=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">et</span>(<span class="at">amt=</span><span class="dv">20</span>, <span class="at">evid=</span><span class="dv">7</span>)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>transit <span class="ot">&lt;-</span> <span class="fu">rxSolve</span>(mod, et)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ parameter labels from comments will be replaced by 'label()'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>using C compiler: ‘Apple clang version 15.0.0 (clang-1500.0.40.1)’
using SDK: ‘’
ld: warning: -single_module is obsolete
ld: warning: -multiply_defined is obsolete</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(transit, <span class="fu">aes</span>(time, cen)) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Concentration"</span>) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07_single_subjects_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A couple of things to keep in mind when using this approach:</p>
<ul>
<li><p>This approach implicitly assumes that the absorption through the transit compartment is completed before the next dose is given If this isn’t the case, some additional code is needed to correct for this <span class="citation" data-cites="Wilkins2008">(<a href="references.html#ref-Wilkins2008" role="doc-biblioref">4</a>)</span>.</p></li>
<li><p>Different dose types (bolus or infusion) to the <code>depot</code> compartment affect the time after dose calculation (<code>tad</code>) which is used in the transit compartment code. Direct doses into compartments are therefore not currently supported. The most stable way around this is to use <code>tad(cmt)</code> and <code>podo(cmt)</code> - this way, doses to other compartments do not affect the transit compartment machinery.</p></li>
<li><p>Internally, the <code>transit</code> syntax uses either the currently defined compartment, <code>d/dt(cmt)=transit(...)</code>, or <code>cmt</code>. If the transit compartment is used outside of a <code>d/dt()</code> (not recommended), the <code>cmt</code> that is used is the last <code>d/dt(cmt)</code> defined it the model. This also means compartments do not affect one another (ie a oral, transit compartment drug dosed immediately with an IV infusion)</p></li>
</ul>
</section>
<section id="covariates" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="covariates"><span class="header-section-number">7.5</span> Covariates</h2>
</section>
<section id="multiple-subjects" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="multiple-subjects"><span class="header-section-number">7.6</span> Multiple subjects</h2>
</section>
<section id="working-with-rxode2-output" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="working-with-rxode2-output"><span class="header-section-number">7.7</span> Working with <code>rxode2</code> output</h2>
</section>
<section id="piping" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="piping"><span class="header-section-number">7.8</span> Piping</h2>
</section>
<section id="special-cases" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="special-cases"><span class="header-section-number">7.9</span> Special cases</h2>
<section id="jacobian-solving" class="level3" data-number="7.9.1">
<h3 data-number="7.9.1" class="anchored" data-anchor-id="jacobian-solving"><span class="header-section-number">7.9.1</span> Jacobian solving</h3>
</section>
<section id="rxode2-models-in-shiny" class="level3" data-number="7.9.2">
<h3 data-number="7.9.2" class="anchored" data-anchor-id="rxode2-models-in-shiny"><span class="header-section-number">7.9.2</span> <code>rxode2</code> models in <code>shiny</code></h3>
</section>
<section id="precompiled-rxode2-models-in-other-r-packages" class="level3" data-number="7.9.3">
<h3 data-number="7.9.3" class="anchored" data-anchor-id="precompiled-rxode2-models-in-other-r-packages"><span class="header-section-number">7.9.3</span> Precompiled <code>rxode2</code> models in other R packages</h3>


<div id="refs" class="references csl-bib-body" role="list" style="display: none">
<div id="ref-Plevyak" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Fidler M, Plevyak J. Dparser: Port of ’dparser’ package. 2023. </div>
</div>
<div id="ref-Wendling2016" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Wendling T, Tsamandouras N, Dumitras S, Pigeolet E, Ogungbenro K, Aarons L. Reduction of a <span>Whole</span>-<span>Body</span> <span>Physiologically</span> <span>Based</span> <span>Pharmacokinetic</span> <span>Model</span> to <span>Stabilise</span> the <span>Bayesian</span> <span>Analysis</span> of <span>Clinical</span> <span>Data</span>. The AAPS Journal [Internet]. 2016;18(1):196–209. Available from: <a href="http://link.springer.com/10.1208/s12248-015-9840-7">http://link.springer.com/10.1208/s12248-015-9840-7</a></div>
</div>
<div id="ref-Savic2007" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Savic RM, Jonker DM, Kerbusch T, Karlsson MO. <a href="https://doi.org/10.1007/s10928-007-9066-0">Implementation of a transit compartment model for describing drug absorption in pharmacokinetic studies</a>. Journal of Pharmacokinetics and Pharmacodynamics. 2007;34(5):711–26. </div>
</div>
<div id="ref-Wilkins2008" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Wilkins JJ, Savic RM, Karlsson MO, Langdon G, McIlleron H, Pillai G, et al. <a href="https://doi.org/10.1128/AAC.00461-07">Population pharmacokinetics of rifampin in pulmonary tuberculosis patients, including a semimechanistic model to describe variable absorption</a>. Antimicrobial Agents and Chemotherapy. 2008;52(6):2138–48. </div>
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06_events.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Events in <code>rxode2</code> and <code>nlmixr2</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08_populations.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Simulating populations</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Nonlinear mixed-effects modelling with nlmixr2 was written by Matthew Fidler, Justin Wilkins, William Denney, John Harrold, Richard Hooijmaaijers, Rik Schoemaker, Mirjam Trame, Yuan Xiong and Huijuan Xu.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>